<div class="card">
    <div class="card-header">

        <h2> {{headerText}} </h2>
        <button *ngIf="!Formstate" class="btn btn-primary" (click)="CreateNew()">Create New</button>
        <br *ngIf="!Formstate">
        <div class="alert alert-danger" *ngIf="errorMessage">
            <p>{{errorMessage}}</p>
        </div>
    </div>
    <div class="card-block" *ngIf="showTable">
        <div class="form-group row alert alert-success" style="margin: 10px 5px; padding: 5px;" *ngIf="currentUser.jobClass != 3">
            <label for="userID" class="control-lable col-md-3 text-right">Select a User</label>
            <div class="col-md-9">
                <select class="form-control" name="userID" (change)="UserChanged($event)">
                    <option value="null">Select a User...</option>
                    <option *ngFor="let user of users" [ngValue]="user.UserID">{{user.UserName + " @ "+ user.LineName}}</option>
                </select>
            </div>
        </div>
        <div *ngIf="selUser">
            <table id="tblVisits" class="table table-hover table-striped">
                <colgroup>
                    <col width="20%" />
                    <col width="20%" />
                    <col width="20%" />
                    <col width="20%" />
                    <col width="20%" />
                </colgroup>
                <thead>
                    <tr>
                        <th> MonthNo <i (click)="SortTable('MonthNo')" class="btn btn-default" [ngClass]="(orderbyString.indexOf('MonthNo') == 1) ? orderbyClass : 'glyphicon glyphicon-sort'"></i></th>
                        <th> WeekNo <i (click)="SortTable('WeekNo')" class="btn btn-default" [ngClass]="(orderbyString.indexOf('WeekNo') == 1) ? orderbyClass : 'glyphicon glyphicon-sort'"></i></th>
                        <th> StartDate <i (click)="SortTable('StartDate')" class="btn btn-default" [ngClass]="(orderbyString.indexOf('StartDate') == 1) ? orderbyClass : 'glyphicon glyphicon-sort'"></i></th>
                        <th> UserName <i (click)="SortTable('UserName')" class="btn btn-default" [ngClass]="(orderbyString.indexOf('UserName') == 1) ? orderbyClass : 'glyphicon glyphicon-sort'"></i></th>
                        <th></th>
                    </tr>
                    <tr>
                        <th>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon1"><i class="glyphicon glyphicon-search"></i></span>
                                <input type="text" class="form-control" id="srchMonthNo" name="MonthNo" [(ngModel)]="srchObj.MonthNo">
                            </div>
                        </th>
                        <th>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon1"><i class="glyphicon glyphicon-search"></i></span>
                                <input type="text" class="form-control" id="srchWeekNo" name="WeekNo" [(ngModel)]="srchObj.WeekNo">
                            </div>
                        </th>
                        <th>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon1"><i class="glyphicon glyphicon-search"></i></span>
                                <input type="date" class="form-control" id="srchStartDate" name="StartDate" [(ngModel)]="srchObj.StartDate">
                            </div>
                        </th>
                        <th>
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon1"><i class="glyphicon glyphicon-search"></i></span>
                                <input type="text" class="form-control" id="srchUserName" name="UserName" [(ngModel)]="srchObj.UserName">
                            </div>
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of (userVisits | filter:srchObj | orderby:orderbyString) | paginate: { itemsPerPage: 25, currentPage: p }">
                        <td>{{item.MonthNo}}</td>
                        <td>{{item.WeekNo}}</td>
                        <td>{{item.StartDate | date: 'dd/MM/yyyy'}}</td>
                        <td>{{item.UserName}}</td>
                        <td>
                            <button *ngIf="currentUser.jobClass < 4 && currentUser.userID == item.UserID" (click)='onEdit(item.WplanID)' class="btn btn-info"
                                title="Edit"><i class="glyphicon glyphicon-pencil"></i></button>
                            <button (click)="onDetail(item.WplanID)" class="btn btn-warning" title="Details"><i class="glyphicon glyphicon-eye-open"></i></button>
                            <button *ngIf="currentUser.userID == item.UserID" (click)="onDelete(item.WplanID)" class="btn btn-danger" title="Delete"><i class="glyphicon glyphicon-trash"></i></button>
                        </td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>
    <div class="card-block" *ngIf="Formstate">
        <form [formGroup]="inFrm" (submit)="inFrm.valid && HandleForm($event)" novalidate>
            <div class="form-horizontal">

                <h2 *ngIf="Formstate == 'Delete'">Are you sure you want to delete this plan ?</h2>
                <br>
            </div>
            <div class="card">
                <h3 class="card-header alert alert-info" style="margin: 10px 5px; padding: 5px;">Basic Data</h3>
                <div class="card-block">
                    <div class="form-group" [ngClass]="{ 'has-error': inFrm.submitted && !inFrm.controls['strtDate'].valid }">
                        <label for="StartDate" class="control-label col-md-2 col-sm-2">Plan Date</label>
                        <div class="col-md-10 col-sm-10">
                            <input id="StartDate" class="form-control" type="date" name="VisitDate" [(ngModel)]="cnvVisitDate" [formControl]="inFrm.controls['strtDate']"
                                [min]="yesterday" [max]="thisday">
                            <div class='error' *ngIf="(inFrm.controls['strtDate'].touched && !inFrm.controls['strtDate'].valid) || (inFrm.submitted && !inFrm.controls['strtDate'].valid)">
                                <div class="alert alert-danger" *ngIf="inFrm.controls['strtDate'].hasError('required')">Plan Date is required.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3>Customers</h3>
                    <button type="button" class="btn btn-primary" (click)="ToggleAllDrugs(true)">Select All</button>
                    <button type="button" class="btn btn-warning" (click)="ToggleAllDrugs(false)">Unselect All</button>
                </div>
                <div class="card-block">
                    <ul>
                        <li *ngFor="let item of plnDest | orderby:'+Destination'">
                            <input type="checkbox" [name]="item.DestID" [checked]="item.Selected" (change)="item.Selected = $event.target.checked">                            {{item.DrugName}}
                        </li>
                    </ul>
                    <!-- <table id="tblCustomers" class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th>Specification</th>
                                <th>Region-Province</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of customers; let i = index">
                                <td>{{item.Destination}}</td>
                                <td>{{item.SpecName}}</td>
                                <td>{{item.RegionProvince}}</td>
                                <td><button type="button" class="btn btn-default" (click)="DeleteDrug(i)">Delete</button></td>
                            </tr>
                        </tbody>
                    </table> -->
                </div>
            </div>
        </form>
    </div>
</div>